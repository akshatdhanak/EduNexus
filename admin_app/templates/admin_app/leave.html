{% extends "layout.html" %}

{% block title %}Leave Requests{% endblock %}


{% block container %}
<div class="page-container">
    <div class="page-header">
        <h1>Leave Management</h1>
        <p class="subtitle">Review and approve absence requests</p>
    </div>

    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>Role</th>
                    <th>Leave Start Date</th>
                    <th>Leave End Date</th>
                    <th>Reason</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for leave in leaves %}
                <tr>
                    <td class="font-medium">{{ leave.user.username }}</td>
                    <td>
                        <span class="role-badge role-{{ leave.user.role }}">{{ leave.user.role }}</span>
                    </td>
                    <td>{{ leave.start_date|date:"M. d, Y" }}</td>
                    <td>{{ leave.end_date|date:"M. d, Y" }}</td>
                    <td class="reason-cell">{{ leave.reason }}</td>
                    <td>
                        <select class="status-select status-{{ leave.status }}" data-leave-id="{{ leave.id }}">
                            <option value="panding" {% if leave.status == "pending" or leave.status == "panding" %}selected{% endif %}>Pending</option>
                            <option value="approved" {% if leave.status == "approved" %}selected{% endif %}>Approved</option>
                            <option value="rejected" {% if leave.status == "rejected" %}selected{% endif %}>Rejected</option>
                        </select>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <div class="page-actions">
        <a href="{% url 'admin_app:admin_dashboard' %}" class="btn-secondary">Back to Dashboard</a>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".status-select").forEach(dropdown => {
        dropdown.addEventListener("change", function () {
            let leaveId = this.getAttribute("data-leave-id");
            let newStatus = this.value;
            let selectElement = this;

            fetch("{% url 'admin_app:update_leave_status' %}", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}"
                },
                body: JSON.stringify({
                    leave_id: leaveId,
                    status: newStatus
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update visual status
                    selectElement.className = 'status-select status-' + newStatus.toLowerCase();
                } else {
                    alert("Failed to update status.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred while updating status.");
            });
        });
    });
});
</script>

{% endblock %}



{% block style %}
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background-color: #fafafa;
    color: #1a1a1a;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
}

.page-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 40px 20px;
}

.page-header {
    margin-bottom: 32px;
}

.page-header h1 {
    font-size: 24px;
    font-weight: 500;
    color: #1a1a1a;
    margin-bottom: 8px;
    letter-spacing: -0.02em;
}

.subtitle {
    font-size: 14px;
    color: #666;
    font-weight: 400;
}

.table-container {
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 24px;
}

.data-table {
    width: 100%;
    border-collapse: collapse;
}

.data-table thead {
    background-color: #1a1a1a;
    color: #ffffff;
}

.data-table th {
    padding: 12px 16px;
    text-align: left;
    font-size: 13px;
    font-weight: 500;
    letter-spacing: 0.02em;
}

.data-table tbody tr {
    border-bottom: 1px solid #f0f0f0;
    transition: background-color 0.15s;
}

.data-table tbody tr:hover {
    background-color: #fafafa;
}

.data-table td {
    padding: 14px 16px;
    font-size: 14px;
    color: #1a1a1a;
}

.font-medium {
    font-weight: 500;
}

.role-badge {
    display: inline-block;
    padding: 4px 10px;
    font-size: 12px;
    font-weight: 500;
    border-radius: 2px;
    text-transform: capitalize;
    letter-spacing: 0.01em;
}

.role-student {
    background-color: #f0f0f0;
    color: #1a1a1a;
}

.role-faculty {
    background-color: #e8e8e8;
    color: #1a1a1a;
}

.reason-cell {
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.status-select {
    padding: 6px 30px 6px 10px;
    border: 1px solid #d0d0d0;
    border-radius: 2px;
    background-color: #ffffff;
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%231a1a1a' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    transition: border-color 0.2s;
}

.status-select:focus {
    outline: none;
    border-color: #1a1a1a;
}

.status-pending,
.status-panding {
    color: #8b6914;
    background-color: #fef9e7;
    border-color: #f4e5b8;
}

.status-approved {
    color: #1a5c1a;
    background-color: #e8f5e8;
    border-color: #c3e6c3;
}

.status-rejected {
    color: #8b1a1a;
    background-color: #fae8e8;
    border-color: #f0c3c3;
}

.page-actions {
    display: flex;
    justify-content: flex-start;
}

.btn-secondary {
    padding: 10px 24px;
    font-size: 14px;
    font-weight: 500;
    background-color: transparent;
    color: #666;
    border: 1px solid #d0d0d0;
    border-radius: 2px;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-block;
    letter-spacing: 0.01em;
}

.btn-secondary:hover {
    background-color: #f5f5f5;
    color: #1a1a1a;
}

@media (max-width: 768px) {
    .page-container {
        padding: 20px 16px;
    }
    
    .table-container {
        overflow-x: auto;
    }
    
    .data-table {
        min-width: 800px;
    }
}

{% endblock %}